<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculator â€” Simple & Responsive</title>
  <style>
    :root{
      --bg:#0f1720; --panel:#0b1220; --muted:#9aa4b2; --accent:#8ab4ff; --glass: rgba(255,255,255,0.03);
      --btn-bg: rgba(255,255,255,0.03); --btn-radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(138,180,255,0.06), transparent), var(--bg);
      color:#e6eef8; display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .card{width:100%; max-width:420px; background:linear-gradient(180deg,var(--panel), #07101a); border-radius:18px; padding:18px; box-shadow:0 10px 30px rgba(2,6,23,0.6);}
    .top{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    .title{font-weight:700;letter-spacing:0.2px}
    .modes{display:flex;gap:8px;align-items:center}
    .display{background:var(--glass); padding:16px;border-radius:12px; text-align:right; overflow:hidden}
    .value{font-size:32px;line-height:1.05; font-weight:600; word-break:break-all}
    .small{font-size:13px;color:var(--muted); margin-top:6px}
    .pad{display:grid; grid-template-columns: repeat(4,1fr); gap:10px; margin-top:14px}
    button.key{background:var(--btn-bg); border:0;padding:14px;border-radius:var(--btn-radius);font-size:18px;font-weight:600;cursor:pointer;backdrop-filter: blur(6px)}
    button.op{background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));}
    button.equal{grid-column:span 2;background:linear-gradient(180deg,var(--accent),#5f8cff);color:#001;box-shadow: 0 8px 18px rgba(88,120,255,0.18);}
    .secondary{font-size:13px;color:var(--muted)}
    .history{margin-top:12px; max-height:110px; overflow:auto; border-radius:10px; padding:8px; background: rgba(255,255,255,0.02)}
    .hitem{font-size:13px;color:var(--muted); padding:6px 8px; border-radius:8px}
    .hitem strong{color:#fff; display:block}
    .controls{display:flex;gap:8px;align-items:center}
    .icon{width:36px;height:36px;border-radius:10px;display:inline-flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.02);cursor:pointer}
    @media (max-width:420px){.card{padding:14px}.value{font-size:28px}}
  </style>
</head>
<body>
  <main class="card" role="application" aria-label="Calculator">
    <div class="top">
      <div>
        <div class="title">Calculator</div>
        <div class="small">Smart, responsive, keyboard-friendly</div>
      </div>
      <div class="modes">
        <div class="controls">
          <div class="icon" id="copyBtn" title="Copy result">ðŸ“‹</div>
        </div>
        <label style="display:flex;gap:8px;align-items:center">
          <input type="checkbox" id="darkToggle" checked />
          <span style="font-size:13px;color:var(--muted)">Dark</span>
        </label>
      </div>
    </div>

    <div class="display" aria-live="polite">
      <div id="expression" class="small" aria-hidden="true">&nbsp;</div>
      <div id="result" class="value">0</div>
    </div>

    <div class="pad" role="group" aria-label="calculator buttons">
      <button class="key" data-action="clear">C</button>
      <button class="key" data-action="back">âŒ«</button>
      <button class="key" data-value="%">%</button>
      <button class="key op" data-value="/">Ã·</button>

      <button class="key" data-value="7">7</button>
      <button class="key" data-value="8">8</button>
      <button class="key" data-value="9">9</button>
      <button class="key op" data-value="*">Ã—</button>

      <button class="key" data-value="4">4</button>
      <button class="key" data-value="5">5</button>
      <button class="key" data-value="6">6</button>
      <button class="key op" data-value="-">âˆ’</button>

      <button class="key" data-value="1">1</button>
      <button class="key" data-value="2">2</button>
      <button class="key" data-value="3">3</button>
      <button class="key op" data-value="+">+</button>

      <button class="key" data-value="0" style="grid-column:span 2">0</button>
      <button class="key" data-value=".">.</button>
      <button class="key equal" data-action="equals">=</button>
    </div>

    <div class="history" id="history" aria-label="calculation history"></div>
  </main>

  <script>
    // Simple calculator logic with safe eval (parser-lite) and keyboard support
    (function(){
      const resultEl = document.getElementById('result');
      const exprEl = document.getElementById('expression');
      const historyEl = document.getElementById('history');
      let expr = '';

      function updateUI(){
        exprEl.textContent = expr || '\u00A0';
        try{
          const value = expr && /[0-9]/.test(expr) ? evaluateExpression(expr) : 0;
          resultEl.textContent = String(value);
        }catch(e){ resultEl.textContent = 'Error' }
      }

      function append(ch){
        // prevent multiple dots in a number
        if(ch === '.' ){
          const parts = expr.split(/[-+*/%()]/);
          const last = parts[parts.length-1]||'';
          if(last.includes('.')) return;
        }
        expr += ch; updateUI();
      }

      function clearAll(){ expr=''; updateUI(); }
      function back(){ expr = expr.slice(0,-1); updateUI(); }

      function addHistory(item, value){
        const node = document.createElement('div'); node.className='hitem';
        node.innerHTML = `<div>${item}</div><strong>${value}</strong>`;
        historyEl.prepend(node);
        // keep history length small
        while(historyEl.children.length>8) historyEl.removeChild(historyEl.lastChild);
      }

      function safePercentTransform(s){
        // transform occurrences like 50% -> (50/100)
        return s.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
      }

      function evaluateExpression(s){
        // allow numbers, + - * / ( ) . and %
        if(/[^0-9+\-*/().%\s]/.test(s)) throw new Error('Invalid characters');
        const replaced = safePercentTransform(s);
        // eslint-disable-next-line no-new-func
        const fn = new Function('return (' + replaced + ')');
        const res = fn();
        if(!isFinite(res)) throw new Error('Bad result');
        // trim floating precision
        return Math.round((res + Number.EPSILON) * 1e12)/1e12;
      }

      document.querySelectorAll('button.key').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const v = btn.dataset.value; const action = btn.dataset.action;
          if(action==='clear'){ clearAll(); return }
          if(action==='back'){ back(); return }
          if(action==='equals'){ try{ const val = evaluateExpression(expr); addHistory(expr+' =', val); expr = String(val); updateUI(); }catch(e){ resultEl.textContent='Error' } return }
          if(v) append(v);
        })
      })

      // keyboard support
      window.addEventListener('keydown', (e)=>{
        const allowed = '0123456789+-*/().%';
        if(e.key === 'Enter' || e.key === '='){ e.preventDefault(); document.querySelector('[data-action="equals"]').click(); return }
        if(e.key === 'Backspace'){ e.preventDefault(); back(); return }
        if(e.key === 'Escape'){ e.preventDefault(); clearAll(); return }
        if(allowed.includes(e.key)){ append(e.key); e.preventDefault(); }
      })

      // copy button
      document.getElementById('copyBtn').addEventListener('click', async ()=>{
        try{ await navigator.clipboard.writeText(resultEl.textContent); alert('Result copied') }catch(e){ alert('Copy failed') }
      })

      // dark toggle (just a simple theme switch)
      const darkToggle = document.getElementById('darkToggle');
      darkToggle.addEventListener('change', ()=>{
        if(darkToggle.checked){ document.documentElement.style.setProperty('--bg','#0f1720'); document.documentElement.style.setProperty('--panel','#0b1220'); document.documentElement.style.setProperty('--muted','#9aa4b2'); }
        else{ document.documentElement.style.setProperty('--bg','#f6f8fb'); document.documentElement.style.setProperty('--panel','#ffffff'); document.documentElement.style.setProperty('--muted','#5b6470'); document.documentElement.style.setProperty('--btn-bg','rgba(2,6,23,0.03)'); document.body.style.color='#06202b'; }
      })

      // init
      updateUI();

    })();
  </script>
</body>
</html>
